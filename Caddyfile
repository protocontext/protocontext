# ProtoContext — Caddy reverse proxy
# With a domain: auto HTTPS via Let's Encrypt.
# Without a domain: serves on :80 (accessible by IP).

{$DOMAIN::80} {
	# API endpoints
	handle /search* {
		reverse_proxy api:8000
	}
	handle /site* {
		reverse_proxy api:8000
	}
	handle /submit* {
		reverse_proxy api:8000
	}
	handle /upload* {
		reverse_proxy api:8000
	}
	handle /delete* {
		reverse_proxy api:8000
	}
	handle /batch* {
		reverse_proxy api:8000
	}
	handle /content* {
		reverse_proxy api:8000
	}
	handle /stats* {
		reverse_proxy api:8000
	}
	handle /health* {
		reverse_proxy api:8000
	}
	handle /auth/* {
		reverse_proxy api:8000
	}
	handle /api-keys* {
		reverse_proxy api:8000
	}
	handle /settings* {
		reverse_proxy api:8000
	}

	# Everything else → dashboard
	handle {
		reverse_proxy dashboard:3000
	}
}
